<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSum Analysis API - Test Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-zinc-50">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <div class="bg-white border-b border-zinc-200">
            <div class="max-w-7xl mx-auto px-6 py-6">
                <h1 class="text-3xl font-semibold text-zinc-900">üî¨ MedSum Analysis API</h1>
                <p class="text-zinc-600 mt-2">Complete Testing Interface for Transcription & Summary Analysis</p>
                <div class="mt-3">
                    <span id="dbStatusBadge" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-zinc-100 text-zinc-600 border border-zinc-200">DB: Checking...</span>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white border-b border-zinc-200 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex gap-8">
                    <button class="tab-button active px-1 py-4 text-sm font-medium text-zinc-700 border-b-2 border-blue-600 transition-all hover:text-zinc-900" onclick="switchTab('transcription')">
                        üìù Transcription Analysis
                    </button>
                    <button class="tab-button px-1 py-4 text-sm font-medium text-zinc-600 border-b-2 border-transparent transition-all hover:text-zinc-900" onclick="switchTab('summary')">
                        üìã Summary Analysis
                    </button>
                    <button class="tab-button px-1 py-4 text-sm font-medium text-zinc-600 border-b-2 border-transparent transition-all hover:text-zinc-900" onclick="switchTab('corrections')">
                        ‚úèÔ∏è Corrections Analytics
                    </button>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 max-w-7xl mx-auto w-full px-6 py-8">
            <!-- Transcription Analysis Tab -->
            <div id="transcription-tab" class="tab-content active space-y-8">
                <!-- Configuration Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">‚öôÔ∏è Configuration</h2>
                        <p class="text-sm text-zinc-600 mt-1">Set your API endpoint and storage type</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">API Base URL</label>
                            <input type="text" id="apiUrl" value="http://localhost:8080" placeholder="http://localhost:8080" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Storage Type</label>
                            <select id="storageType" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="minio">MinIO (Local)</option>
                                <option value="s3">AWS S3 (Production)</option>
                            </select>
                        </div>
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="testConnection()">üîó Test Connection</button>
                        <div id="connectionStatus"></div>
                    </div>
                </div>

                <!-- Health Check Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üíö Health Check</h2>
                        <p class="text-sm text-zinc-600 mt-1">Verify API is running and accessible</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="checkHealth()"><i class="fa-solid fa-heart-pulse"></i> Check Health</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="checkAllServices()"><i class="fa-solid fa-magnifying-glass"></i> Check All Services</button>
                        </div>
                        <div id="healthResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üìÅ File Upload & Management</h2>
                        <p class="text-sm text-zinc-600 mt-1">Upload transcript files and manage storage</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Job</label>
                            <input type="text" id="job" value="test-job-456" placeholder="Enter job" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <div class="border-2 border-dashed border-zinc-300 rounded-lg p-6 text-center hover:border-zinc-400 transition-colors cursor-pointer relative group">
                            <input type="file" id="transcriptionFile" accept=".txt" class="hidden">
                            <label for="transcriptionFile" class="cursor-pointer">
                                <div class="text-4xl mb-2">üìÑ</div>
                                <div class="font-medium text-zinc-900">Transcription File</div>
                                <div class="text-sm text-zinc-600">Click to select (.txt)</div>
                            </label>
                            <div id="transcriptionFileName" class="text-xs text-zinc-500 mt-2"></div>
                        </div>
                        
                        <div class="border-2 border-dashed border-zinc-300 rounded-lg p-6 text-center hover:border-zinc-400 transition-colors cursor-pointer">
                            <input type="file" id="correctedFile" accept=".txt" class="hidden">
                            <label for="correctedFile" class="cursor-pointer">
                                <div class="text-4xl mb-2">‚úÖ</div>
                                <div class="font-medium text-zinc-900">Corrected Transcript</div>
                                <div class="text-sm text-zinc-600">Click to select (.txt)</div>
                            </label>
                            <div id="correctedFileName" class="text-xs text-zinc-500 mt-2"></div>
                        </div>
                        
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="uploadFiles()"><i class="fa-solid fa-upload"></i> Upload Files</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="listFiles()"><i class="fa-solid fa-list"></i> List Files</button>
                        </div>
                        <div id="uploadResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Job Processing Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">‚ö° Job Processing</h2>
                        <p class="text-sm text-zinc-600 mt-1">Trigger analysis jobs and monitor progress</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Job to Process</label>
                            <input type="text" id="triggerJob" value="test-job-456" placeholder="Enter job" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="triggerJob()"><i class="fa-solid fa-rocket"></i> Trigger Analysis</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="checkJobStatus()"><i class="fa-solid fa-chart-line"></i> Check Status</button>
                        </div>
                        <div id="jobResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Analysis Results Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üìä Analysis Results</h2>
                        <p class="text-sm text-zinc-600 mt-1">Retrieve and display analysis metrics</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Job</label>
                            <input type="text" id="analysisJob" value="test-job-123" placeholder="Enter job" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="getAnalysis()"><i class="fa-solid fa-square-poll-vertical"></i> Get Results</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="getAnalysisFormatted()"><i class="fa-regular fa-object-group"></i> Get Formatted Results</button>
                        </div>
                        <div id="analysisResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                        <div id="metricsDisplay" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="werValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">WER (Word Error Rate)</div>
                            </div>
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="cerValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">CER (Character Error Rate)</div>
                            </div>
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="bleuValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">BLEU Score</div>
                            </div>
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="cometValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">COMET Score</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Database Testing Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üóÑÔ∏è Database Testing</h2>
                        <p class="text-sm text-zinc-600 mt-1">Test database connectivity and data storage</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="testDatabase()"><i class="fa-solid fa-database"></i> Test DB Connection</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="listAllResults()"><i class="fa-solid fa-list"></i> List All Results</button>
                            <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="clearTestData()"><i class="fa-solid fa-trash-can"></i> Clear Test Data</button>
                        </div>
                        <div id="databaseResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- End-to-End Testing -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üîÑ End-to-End Testing</h2>
                        <p class="text-sm text-zinc-600 mt-1">Complete pipeline testing from upload to results</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="text-sm text-blue-900"><strong>Info:</strong> This will run a complete test including file upload, job processing, and result retrieval.</div>
                        </div>
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="runFullPipelineTest()"><i class="fa-solid fa-diagram-project"></i> Run Full Pipeline Test</button>
                        <div id="pipelineResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>
            </div>

            <!-- Summary Analysis Tab -->
            <div id="summary-tab" class="tab-content hidden space-y-8">
                <!-- Configuration Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">‚öôÔ∏è Configuration</h2>
                        <p class="text-sm text-zinc-600 mt-1">Set your API endpoint and storage type</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">API Base URL</label>
                            <input type="text" id="summaryApiUrl" value="http://localhost:8080" placeholder="http://localhost:8080" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Storage Type</label>
                            <select id="summaryStorageType" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <option value="minio">MinIO (Local)</option>
                                <option value="s3">AWS S3 (Production)</option>
                            </select>
                        </div>
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="testSummaryConnection()"><i class="fa-solid fa-link"></i> Test Connection</button>
                        <div id="summaryConnectionStatus"></div>
                    </div>
                </div>

                <!-- Health Check Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üíö Health Check</h2>
                        <p class="text-sm text-zinc-600 mt-1">Verify Summary API is running and accessible</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="checkSummaryHealth()"><i class="fa-solid fa-heart-pulse"></i> Check Health</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="checkSummaryServices()"><i class="fa-solid fa-magnifying-glass"></i> Check All Services</button>
                        </div>
                        <div id="summaryHealthResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üìÅ Summary File Upload</h2>
                        <p class="text-sm text-zinc-600 mt-1">Upload original and summary files</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Job</label>
                            <input type="text" id="summaryJob" value="summary-job-456" placeholder="Enter job" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        
                        <div class="border-2 border-dashed border-zinc-300 rounded-lg p-6 text-center hover:border-zinc-400 transition-colors">
                            <input type="file" id="originalSummaryFile" accept=".txt" class="hidden">
                            <label for="originalSummaryFile" class="cursor-pointer">
                                <div class="text-4xl mb-2">üìÑ</div>
                                <div class="font-medium text-zinc-900">Original Text</div>
                                <div class="text-sm text-zinc-600">Click to select (.txt)</div>
                            </label>
                            <div id="originalSummaryFileName" class="text-xs text-zinc-500 mt-2"></div>
                        </div>
                        
                        <div class="border-2 border-dashed border-zinc-300 rounded-lg p-6 text-center hover:border-zinc-400 transition-colors">
                            <input type="file" id="generatedSummaryFile" accept=".txt" class="hidden">
                            <label for="generatedSummaryFile" class="cursor-pointer">
                                <div class="text-4xl mb-2">‚úÖ</div>
                                <div class="font-medium text-zinc-900">Generated Summary</div>
                                <div class="text-sm text-zinc-600">Click to select (.txt)</div>
                            </label>
                            <div id="generatedSummaryFileName" class="text-xs text-zinc-500 mt-2"></div>
                        </div>
                        
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="uploadSummaryFiles()"><i class="fa-solid fa-upload"></i> Upload Files</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="listSummaryFiles()"><i class="fa-solid fa-list"></i> List Files</button>
                        </div>
                        <div id="summaryUploadResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Summary Job Processing Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">‚ö° Summary Job Processing</h2>
                        <p class="text-sm text-zinc-600 mt-1">Trigger summary analysis jobs and monitor progress</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Job to Process</label>
                            <input type="text" id="triggerSummaryJob" value="summary-job-456" placeholder="Enter job" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="triggerSummaryJob()"><i class="fa-solid fa-rocket"></i> Trigger Analysis</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="checkSummaryJobStatus()"><i class="fa-solid fa-chart-line"></i> Check Status</button>
                        </div>
                        <div id="summaryJobResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Summary Analysis Results Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üìä Summary Analysis Results</h2>
                        <p class="text-sm text-zinc-600 mt-1">Retrieve and display summary analysis metrics</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Job</label>
                            <input type="text" id="summaryAnalysisJob" value="summary-job-123" placeholder="Enter job" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="getSummaryAnalysis()"><i class="fa-solid fa-square-poll-vertical"></i> Get Results</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="getSummaryAnalysisFormatted()"><i class="fa-regular fa-object-group"></i> Get Formatted Results</button>
                        </div>
                        <div id="summaryAnalysisResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                        <div id="summaryMetricsDisplay" class="hidden grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="summaryWerValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">WER (Word Error Rate)</div>
                            </div>
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="summaryCerValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">CER (Character Error Rate)</div>
                            </div>
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="summaryBleuValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">BLEU Score</div>
                            </div>
                            <div class="bg-zinc-50 rounded-lg p-4 border border-zinc-200">
                                <div class="text-2xl font-bold text-blue-600" id="summaryRougeValue">-</div>
                                <div class="text-xs font-medium text-zinc-600 mt-1">ROUGE Score</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Database Testing Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üóÑÔ∏è Summary Database Testing</h2>
                        <p class="text-sm text-zinc-600 mt-1">Test summary database operations</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="flex gap-3 flex-wrap">
                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="testSummaryDatabase()"><i class="fa-solid fa-database"></i> Test DB Connection</button>
                            <button class="px-4 py-2 bg-white border border-zinc-300 hover:border-zinc-400 text-zinc-900 rounded-lg font-medium text-sm transition-colors" onclick="listAllSummaryResults()"><i class="fa-solid fa-list"></i> List All Results</button>
                            <button class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="clearSummaryTestData()"><i class="fa-solid fa-trash-can"></i> Clear Test Data</button>
                        </div>
                        <div id="summaryDatabaseResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Summary End-to-End Testing -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üîÑ Summary End-to-End Testing</h2>
                        <p class="text-sm text-zinc-600 mt-1">Complete summary pipeline testing</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="text-sm text-blue-900"><strong>Info:</strong> This will run a complete summary test including file upload, analysis, and result retrieval.</div>
                        </div>
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="runFullSummaryPipelineTest()"><i class="fa-solid fa-diagram-project"></i> Run Full Pipeline Test</button>
                        <div id="summaryPipelineResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>
            </div>

            <!-- Corrections Analytics Tab -->
            <div id="corrections-tab" class="tab-content hidden space-y-8">
                <!-- Configuration Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">‚öôÔ∏è Configuration</h2>
                        <p class="text-sm text-zinc-600 mt-1">Set your API endpoint</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">API Base URL</label>
                            <input type="text" id="correctionsApiUrl" value="http://localhost:8080" placeholder="http://localhost:8080" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <!-- Create Correction Event Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üßæ Create Correction Event</h2>
                        <p class="text-sm text-zinc-600 mt-1">Ingest an event with IDs, explanations, words, and sentence movements</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-zinc-700 mb-2">JobId</label>
                                <input type="text" id="corrJobId" value="job-123" placeholder="job-123" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-zinc-700 mb-2">ModelId</label>
                                <input type="text" id="corrModelId" value="model-abc" placeholder="model-abc" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-zinc-700 mb-2">PromptId</label>
                                <input type="text" id="corrPromptId" value="prompt-evt-1" placeholder="prompt-evt-1" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Explanation</label>
                            <textarea id="corrExplanation" rows="3" placeholder="Describe the correction" class="w-full px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none">Fixed spelling</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Word Correction</label>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="corrWordBefore" value="Kvardirps" placeholder="before" class="px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <input type="text" id="corrWordAfter" value="Quardirecps" placeholder="after" class="px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Sentence Movement</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <input type="text" id="corrOrigLoc" value="section1:sent3" placeholder="original location" class="px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <input type="text" id="corrNewLoc" value="section2:sent1" placeholder="new location" class="px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <input type="text" id="corrTransform" value="moved" placeholder="transformation" class="px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                            </div>
                        </div>
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="createCorrectionEvent()">‚ûï Create Event</button>
                        <div id="corrCreateResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Retrieve & List Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üîç Retrieve & List</h2>
                        <p class="text-sm text-zinc-600 mt-1">Fetch by promptId or list by JobId/ModelId</p>
                    </div>
                    <div class="p-6 space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-zinc-700 mb-2">PromptId</label>
                            <div class="flex gap-3">
                                <input type="text" id="corrGetPromptId" value="prompt-evt-1" placeholder="prompt-evt-1" class="flex-1 px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="getCorrectionByPrompt()">üì• Get Event</button>
                            </div>
                            <div id="corrGetResponse" class="hidden mt-4 bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                            <div id="corrAggregateView" class="mt-4 hidden">
                                <div class="bg-white border border-zinc-300 rounded-lg">
                                    <div class="px-4 py-2 bg-zinc-50 border-b border-zinc-200 text-sm font-semibold text-zinc-800">DB Entries for PromptId</div>
                                    <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div class="bg-white border border-zinc-200 rounded-lg p-4">
                                            <div class="text-sm font-semibold text-zinc-700 mb-2">correction_events</div>
                                            <div id="aggEvent" class="text-sm text-zinc-800"></div>
                                        </div>
                                        <div class="bg-white border border-zinc-200 rounded-lg p-4">
                                            <div class="text-sm font-semibold text-zinc-700 mb-2">correction_explanations</div>
                                            <div id="aggExplanations" class="text-sm text-zinc-800"></div>
                                        </div>
                                        <div class="bg-white border border-zinc-200 rounded-lg p-4">
                                            <div class="text-sm font-semibold text-zinc-700 mb-2">word_corrections</div>
                                            <div id="aggWords" class="text-sm text-zinc-800"></div>
                                        </div>
                                        <div class="md:col-span-3 bg-white border border-zinc-200 rounded-lg p-4">
                                            <div class="text-sm font-semibold text-zinc-700 mb-2">sentence_movements</div>
                                            <div id="aggSentences" class="text-sm text-zinc-800"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t border-zinc-200 pt-6">
                            <label class="block text-sm font-medium text-zinc-700 mb-2">Filter by JobId / ModelId</label>
                            <div class="flex gap-3">
                                <input type="text" id="corrListJobId" value="job-123" placeholder="jobId" class="flex-1 px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <input type="text" id="corrListModelId" value="model-abc" placeholder="modelId" class="flex-1 px-4 py-2 bg-white border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="listCorrections()">üìã List</button>
                            </div>
                            <div id="corrListResponse" class="hidden mt-4 bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                        </div>
                    </div>
                </div>

                <!-- Metrics Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üìà Metrics</h2>
                        <p class="text-sm text-zinc-600 mt-1">View ingestion and dedup counters</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="fetchMetrics()">üìä Fetch Metrics</button>
                        <div id="corrMetricsResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>

                <!-- Quick Test Section -->
                <div class="bg-white rounded-lg border border-zinc-200 overflow-hidden hover:border-zinc-300 transition-colors">
                    <div class="px-6 py-4 bg-zinc-50 border-b border-zinc-200">
                        <h2 class="text-lg font-semibold text-zinc-900">üöÄ Corrections Pipeline</h2>
                        <p class="text-sm text-zinc-600 mt-1">Run complete pipeline test</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm transition-colors" onclick="runCorrectionsPipelineTest()">üöÄ Run Pipeline Test</button>
                        <div id="corrPipelineResponse" class="hidden bg-zinc-900 text-zinc-100 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto whitespace-pre-wrap break-words"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        // Tab Switching Function
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
                button.classList.add('text-zinc-600', 'border-transparent');
                button.classList.remove('text-zinc-900', 'border-blue-600');
            });
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            event.target.classList.add('text-zinc-900', 'border-blue-600');
            event.target.classList.remove('text-zinc-600', 'border-transparent');
        }

        // File selection handlers for Transcription
        document.getElementById('transcriptionFile').addEventListener('change', function(e) {
            document.getElementById('transcriptionFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        document.getElementById('correctedFile').addEventListener('change', function(e) {
            document.getElementById('correctedFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        // File selection handlers for Summary
        document.getElementById('originalSummaryFile').addEventListener('change', function(e) {
            document.getElementById('originalSummaryFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        document.getElementById('generatedSummaryFile').addEventListener('change', function(e) {
            document.getElementById('generatedSummaryFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        // Utility functions
        function getApiUrl(type = 'transcription') {
            return document.getElementById(type === 'summary' ? 'summaryApiUrl' : 'apiUrl').value.replace(/\/$/, '');
        }

        function getSummaryApiUrl() {
            return getApiUrl('summary');
        }

        function showResponse(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.classList.remove('hidden');
            element.textContent = content;
        }

        function formatJson(obj) {
            return JSON.stringify(obj, null, 2);
        }

        function updateMetrics(data) {
            document.getElementById('werValue').textContent = data.wer.toFixed(2);
            document.getElementById('cerValue').textContent = data.cer.toFixed(2);
            document.getElementById('bleuValue').textContent = data.bleu.toFixed(3);
            document.getElementById('cometValue').textContent = data.comet ? data.comet.toFixed(3) : 'N/A';
            document.getElementById('metricsDisplay').classList.remove('hidden');
        }

        function updateSummaryMetrics(data) {
            document.getElementById('summaryWerValue').textContent = data.wer.toFixed(2);
            document.getElementById('summaryCerValue').textContent = data.cer.toFixed(2);
            document.getElementById('summaryBleuValue').textContent = data.bleu.toFixed(3);
            document.getElementById('summaryRougeValue').textContent = data.rouge.toFixed(3);
            document.getElementById('summaryMetricsDisplay').classList.remove('hidden');
        }

        // API Testing Functions
        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = '<div class="mt-2 bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-900">üîÑ Testing connection...</div>';
            
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="mt-2 bg-green-50 border border-green-200 rounded-lg p-3 text-sm text-green-900">‚úÖ Connection successful!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="mt-2 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-900">‚ùå Connection failed!</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="mt-2 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-900">‚ùå Connection error: ${error.message}</div>`;
            }
        }

        function getCorrectionsApiUrl() {
            return document.getElementById('correctionsApiUrl').value.replace(/\/$/, '');
        }

        async function createCorrectionEvent() {
            const url = `${getCorrectionsApiUrl()}/corrections/events`;
            const body = {
                jobId: document.getElementById('corrJobId').value,
                modelId: document.getElementById('corrModelId').value,
                promptId: document.getElementById('corrPromptId').value,
                explanations: [{ explanation: document.getElementById('corrExplanation').value }],
                words: [{ before: document.getElementById('corrWordBefore').value, after: document.getElementById('corrWordAfter').value }],
                sentences: [{ originalLocation: document.getElementById('corrOrigLoc').value, newLocation: document.getElementById('corrNewLoc').value, transformation: document.getElementById('corrTransform').value }]
            };
            try {
                const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                const data = await res.json();
                showResponse('corrCreateResponse', formatJson(data));
            } catch (e) {
                showResponse('corrCreateResponse', e.message);
            }
        }

        async function getCorrectionByPrompt() {
            const pid = document.getElementById('corrGetPromptId').value;
            const url = `${getCorrectionsApiUrl()}/corrections/events/${encodeURIComponent(pid)}`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                showResponse('corrGetResponse', formatJson(data));
                const wrap = document.getElementById('corrAggregateView');
                const ev = document.getElementById('aggEvent');
                const ex = document.getElementById('aggExplanations');
                const wd = document.getElementById('aggWords');
                const sn = document.getElementById('aggSentences');
                wrap.classList.remove('hidden');
                ev.textContent = '';
                ex.innerHTML = '';
                wd.innerHTML = '';
                sn.innerHTML = '';
                if (data && data.event) { renderCorrectionAggregate(data); } else {
                    ev.textContent = 'No event found for this promptId';
                    ex.textContent = '‚Äî';
                    wd.textContent = '‚Äî';
                    sn.textContent = '‚Äî';
                }
            } catch (e) {
                showResponse('corrGetResponse', e.message);
                const wrap = document.getElementById('corrAggregateView');
                const ev = document.getElementById('aggEvent');
                const ex = document.getElementById('aggExplanations');
                const wd = document.getElementById('aggWords');
                const sn = document.getElementById('aggSentences');
                wrap.classList.remove('hidden');
                ev.textContent = 'Error fetching data';
                ex.textContent = '‚Äî';
                wd.textContent = '‚Äî';
                sn.textContent = '‚Äî';
            }
        }

        async function listCorrections() {
            const j = document.getElementById('corrListJobId').value;
            const m = document.getElementById('corrListModelId').value;
            const params = [];
            if (j) params.push(`jobId=${encodeURIComponent(j)}`);
            if (m) params.push(`modelId=${encodeURIComponent(m)}`);
            const qs = params.length ? `?${params.join('&')}` : '';
            const url = `${getCorrectionsApiUrl()}/corrections/events${qs}`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                showResponse('corrListResponse', formatJson(data));
            } catch (e) {
                showResponse('corrListResponse', e.message);
            }
        }

        async function fetchMetrics() {
            const url = `${getCorrectionsApiUrl()}/metrics`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                showResponse('corrMetricsResponse', formatJson(data));
            } catch (e) {
                showResponse('corrMetricsResponse', e.message);
            }
        }

        async function runCorrectionsPipelineTest() {
            const base = getCorrectionsApiUrl();
            const steps = [];
            const log = (isError = false) => showResponse('corrPipelineResponse', steps.join('\n'));
            try {
                steps.push('1. Checking API health...');
                log();
                const health = await fetch(`${base}/healthcheck`);
                if (!health.ok) throw new Error('API health check failed');

                const prompt = `prompt-pipeline-${Date.now()}`;
                const body = {
                    jobId: 'job-pipeline',
                    modelId: 'model-pipeline',
                    promptId: prompt,
                    explanations: [{ explanation: 'Dummy pipeline event' }],
                    words: [{ before: 'alpha', after: 'alpah' }],
                    sentences: [{ originalLocation: 'sec1:sent1', newLocation: 'sec2:sent1', transformation: 'moved' }]
                };

                steps.push('2. Creating correction event...');
                log();
                const postRes = await fetch(`${base}/corrections/events`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
                if (!postRes.ok) throw new Error('Event creation failed');

                steps.push('3. Fetching event by promptId...');
                log();
                const getRes = await fetch(`${base}/corrections/events/${prompt}`);
                const eventData = await getRes.json();
                if (!getRes.ok) throw new Error('Fetch event failed');

                steps.push('4. Fetching metrics...');
                log();
                const mRes = await fetch(`${base}/metrics`);
                const metrics = await mRes.json();
                if (!mRes.ok) throw new Error('Metrics fetch failed');

                steps.push('‚úÖ Pipeline completed');
                showResponse('corrPipelineResponse', steps.join('\n') + '\n\nEvent:\n' + formatJson(eventData) + '\n\nMetrics:\n' + formatJson(metrics));
            } catch (e) {
                steps.push(`‚ùå Error: ${e.message}`);
                log(true);
            }
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                const data = await response.json();
                showResponse('healthResponse', `Status: ${response.status}\nResponse: ${formatJson(data)}`);
            } catch (error) {
                showResponse('healthResponse', `Error: ${error.message}`);
            }
        }

        async function checkAllServices() {
            const services = ['API', 'Database', 'Cache', 'Storage'];
            let results = 'Service Status Check:\n\n';
            
            for (const service of services) {
                results += `${service}: `;
                try {
                    const response = await fetch(`${getApiUrl()}/healthcheck`);
                    results += response.ok ? '‚úÖ Online\n' : '‚ùå Offline\n';
                } catch (error) {
                    results += '‚ùå Error\n';
                }
            }
            
            showResponse('healthResponse', results);
        }

        async function uploadFiles() {
            const job = document.getElementById('job').value;
            const originalFile = document.getElementById('transcriptionFile').files[0];
            const correctedFile = document.getElementById('correctedFile').files[0];
            
            if (!job || !originalFile || !correctedFile) {
                showResponse('uploadResponse', 'Please provide job and both files');
                return;
            }
            
            showResponse('uploadResponse', 'üîÑ Uploading files...');
            
            try {
                const formData = new FormData();
                formData.append('job', job);
                formData.append('transcription', originalFile);
                formData.append('corrected', correctedFile);
                formData.append('originalFile', originalFile);
                formData.append('transcribedFile', correctedFile);

                const response = await fetch(`${getApiUrl()}/transcript-analysis/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('uploadResponse', `Files uploaded successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('uploadResponse', `Error: ${data.error || 'Failed to upload files'}`);
                }
            } catch (error) {
                showResponse('uploadResponse', `Error: ${error.message}`);
            }
        }

        async function listFiles() {
            showResponse('uploadResponse', 'üìã Listing files...');
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/list`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('uploadResponse', `Files in storage:\n${formatJson(data)}`);
                } else {
                    showResponse('uploadResponse', `Error: ${data.error || 'Failed to list files'}`);
                }
            } catch (error) {
                showResponse('uploadResponse', `Error: ${error.message}`);
            }
        }

        async function triggerJob() {
            const job = document.getElementById('triggerJob').value;
            if (!job) {
                showResponse('jobResponse', 'Please provide job');
                return;
            }
            
            showResponse('jobResponse', `üöÄ Triggering analysis for job: ${job}`);
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/trigger/${job}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('jobResponse', `Job triggered successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('jobResponse', `Error: ${data.error || 'Failed to trigger job'}`);
                }
            } catch (error) {
                showResponse('jobResponse', `Error: ${error.message}`);
            }
        }

        async function checkJobStatus() {
            const job = document.getElementById('triggerJob').value;
            if (!job) {
                showResponse('jobResponse', 'Please provide job');
                return;
            }
            
            showResponse('jobResponse', `üìä Checking status for job: ${job}`);
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/status/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('jobResponse', `Job status:\n${formatJson(data)}`);
                } else {
                    showResponse('jobResponse', `Error: ${data.error || 'Failed to check job status'}`);
                }
            } catch (error) {
                showResponse('jobResponse', `Error: ${error.message}`);
            }
        }

        async function getAnalysis() {
            const job = document.getElementById('analysisJob').value;
            if (!job) {
                showResponse('analysisResponse', 'Please provide job');
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('analysisResponse', `Analysis results:\n${formatJson(data)}`);
                    updateMetrics(data);
                } else {
                    showResponse('analysisResponse', `Error: ${data.error || 'Failed to get analysis results'}`);
                    document.getElementById('metricsDisplay').classList.add('hidden');
                }
            } catch (error) {
                showResponse('analysisResponse', `Error: ${error.message}`);
                document.getElementById('metricsDisplay').classList.add('hidden');
            }
        }

        async function getAnalysisFormatted() {
            await getAnalysis();
        }

        async function testDatabase() {
            showResponse('databaseResponse', 'üîÑ Testing database connection...');
            
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('databaseResponse', `Database connection test successful:\n${formatJson(data)}`);
                } else {
                    showResponse('databaseResponse', `Database connection test failed:\n${formatJson(data)}`);
                }
            } catch (error) {
                showResponse('databaseResponse', `Database connection error: ${error.message}`);
            }
        }

        async function listAllResults() {
            showResponse('databaseResponse', 'üîÑ Fetching all analysis results...');
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/list`);
                const data = await response.json();
                if (Array.isArray(data)) {
                    const formattedData = data.map(result => ({
                        ...result,
                        created_at: new Date(result.created_at).toLocaleString(),
                        updated_at: new Date(result.updated_at).toLocaleString()
                    }));
                    showResponse('databaseResponse', `All analysis results:\n${formatJson(formattedData)}`);
                } else {
                    showResponse('databaseResponse', `All analysis results:\n${formatJson(data)}`);
                }
            } catch (error) {
                showResponse('databaseResponse', `Error fetching results: ${error.message}`);
            }
        }

        async function clearTestData() {
            if (confirm('Are you sure you want to clear test data?')) {
                showResponse('databaseResponse', 'üóëÔ∏è Clearing test data...');
                
                try {
                    const response = await fetch(`${getApiUrl()}/transcript-analysis/clear`, { method: 'POST' });
                    const data = await response.json();
                    
                    if (response.ok) {
                        showResponse('databaseResponse', '‚úÖ Test data cleared successfully');
                    } else {
                        showResponse('databaseResponse', `Error: ${data.error || 'Failed to clear test data'}`);
                    }
                } catch (error) {
                    showResponse('databaseResponse', `Error: ${error.message}`);
                }
            }
        }

        async function runFullPipelineTest() {
            const job = 'test-' + Date.now();
            showResponse('pipelineResponse', 'üîÑ Running full pipeline test...');
            
            const steps = [];
            try {
                steps.push('1. Checking API health...');
                showResponse('pipelineResponse', steps.join('\n'));
                const healthResponse = await fetch(`${getApiUrl()}/healthcheck`);
                if (!healthResponse.ok) throw new Error('API health check failed');

                steps.push('2. Uploading files...');
                showResponse('pipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                steps.push('3. Triggering analysis job...');
                showResponse('pipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                steps.push('4. Waiting for processing...');
                showResponse('pipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 2000));

                steps.push('5. Retrieving results...');
                showResponse('pipelineResponse', steps.join('\n'));
                const analysisResponse = await fetch(`${getApiUrl()}/transcript-analysis/${job}`);
                const analysisData = await analysisResponse.json();

                steps.push('‚úÖ Pipeline test completed successfully');
                showResponse('pipelineResponse', steps.join('\n') + '\n\nResults:\n' + formatJson(analysisData));
            } catch (error) {
                steps.push(`‚ùå Error: ${error.message}`);
                showResponse('pipelineResponse', steps.join('\n'));
            }
        }

        // Summary API Testing Functions
        async function testSummaryConnection() {
            const statusDiv = document.getElementById('summaryConnectionStatus');
            statusDiv.innerHTML = '<div class="mt-2 bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-900">üîÑ Testing connection...</div>';
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="mt-2 bg-green-50 border border-green-200 rounded-lg p-3 text-sm text-green-900">‚úÖ Connection successful!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="mt-2 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-900">‚ùå Connection failed!</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="mt-2 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-900">‚ùå Connection error: ${error.message}</div>`;
            }
        }

        async function checkSummaryHealth() {
            try {
                const response = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                const data = await response.json();
                showResponse('summaryHealthResponse', `Status: ${response.status}\nResponse: ${formatJson(data)}`);
            } catch (error) {
                showResponse('summaryHealthResponse', `Error: ${error.message}`);
            }
        }

        async function checkSummaryServices() {
            const services = ['API', 'Database', 'Cache', 'Storage'];
            let results = 'Service Status Check:\n\n';
            
            for (const service of services) {
                results += `${service}: `;
                try {
                    const response = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                    results += response.ok ? '‚úÖ Online\n' : '‚ùå Offline\n';
                } catch (error) {
                    results += '‚ùå Error\n';
                }
            }
            
            showResponse('summaryHealthResponse', results);
        }

        async function uploadSummaryFiles() {
            const job = document.getElementById('summaryJob').value;
            const originalFile = document.getElementById('originalSummaryFile').files[0];
            const summaryFile = document.getElementById('generatedSummaryFile').files[0];
            
            if (!job || !originalFile || !summaryFile) {
                showResponse('summaryUploadResponse', 'Please provide job and both files');
                return;
            }
            
            showResponse('summaryUploadResponse', 'üîÑ Uploading files...');
            
            try {
                const formData = new FormData();
                formData.append('job', job);
                formData.append('originalFile', originalFile);
                formData.append('correctedFile', summaryFile);

                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryUploadResponse', `Files uploaded successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryUploadResponse', `Error: ${data.error || 'Failed to upload files'}`);
                }
            } catch (error) {
                showResponse('summaryUploadResponse', `Error: ${error.message}`);
            }
        }

        async function listSummaryFiles() {
            showResponse('summaryUploadResponse', 'üìã Listing files...');
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/list`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryUploadResponse', `Files in storage:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryUploadResponse', `Error: ${data.error || 'Failed to list files'}`);
                }
            } catch (error) {
                showResponse('summaryUploadResponse', `Error: ${error.message}`);
            }
        }

        async function triggerSummaryJob() {
            const job = document.getElementById('triggerSummaryJob').value;
            if (!job) {
                showResponse('summaryJobResponse', 'Please provide job');
                return;
            }
            
            showResponse('summaryJobResponse', 'üîÑ Triggering summary analysis...');
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/trigger/${job}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryJobResponse', `Job triggered successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryJobResponse', `Error: ${data.error || 'Failed to trigger job'}`);
                }
            } catch (error) {
                showResponse('summaryJobResponse', `Error: ${error.message}`);
            }
        }

        async function checkSummaryJobStatus() {
            const job = document.getElementById('triggerSummaryJob').value;
            if (!job) {
                showResponse('summaryJobResponse', 'Please provide job');
                return;
            }
            
            showResponse('summaryJobResponse', `üìä Checking status for job: ${job}`);
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/status/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryJobResponse', `Job status:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryJobResponse', `Error: ${data.error || 'Failed to check job status'}`);
                }
            } catch (error) {
                showResponse('summaryJobResponse', `Error: ${error.message}`);
            }
        }

        async function getSummaryAnalysis() {
            const job = document.getElementById('summaryAnalysisJob').value;
            if (!job) {
                showResponse('summaryAnalysisResponse', 'Please provide a job');
                return;
            }

            showResponse('summaryAnalysisResponse', 'üîÑ Fetching summary analysis results...');
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryAnalysisResponse', `Summary analysis results:\n${formatJson(data)}`);
                    if (data.metrics) {
                        updateSummaryMetrics(data.metrics);
                    }
                } else {
                    showResponse('summaryAnalysisResponse', `Error: ${data.error || 'Failed to get summary analysis results'}`);
                }
            } catch (error) {
                showResponse('summaryAnalysisResponse', `Error: ${error.message}`);
            }
        }

        async function getSummaryAnalysisFormatted() {
            await getSummaryAnalysis();
        }

        async function testSummaryDatabase() {
            showResponse('summaryDatabaseResponse', 'üîÑ Testing database connection...');
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryDatabaseResponse', `Database connection test successful:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryDatabaseResponse', `Database connection test failed:\n${formatJson(data)}`);
                }
            } catch (error) {
                showResponse('summaryDatabaseResponse', `Database connection error: ${error.message}`);
            }
        }

        async function listAllSummaryResults() {
            showResponse('summaryDatabaseResponse', 'üîÑ Fetching all summary results...');
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/list`);
                const data = await response.json();
                if (Array.isArray(data)) {
                    const formattedData = data.map(result => ({
                        ...result,
                        created_at: new Date(result.created_at).toLocaleString(),
                        updated_at: new Date(result.updated_at).toLocaleString()
                    }));
                    showResponse('summaryDatabaseResponse', `All summary results:\n${formatJson(formattedData)}`);
                } else {
                    showResponse('summaryDatabaseResponse', `All summary results:\n${formatJson(data)}`);
                }
            } catch (error) {
                showResponse('summaryDatabaseResponse', `Error fetching summary results: ${error.message}`);
            }
        }

        async function clearSummaryTestData() {
            if (confirm('Are you sure you want to clear summary test data?')) {
                showResponse('summaryDatabaseResponse', 'üóëÔ∏è Clearing test data...');
                
                try {
                    const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/clear`, { method: 'POST' });
                    const data = await response.json();
                    
                    if (response.ok) {
                        showResponse('summaryDatabaseResponse', '‚úÖ Test data cleared successfully');
                    } else {
                        showResponse('summaryDatabaseResponse', `Error: ${data.error || 'Failed to clear test data'}`);
                    }
                } catch (error) {
                    showResponse('summaryDatabaseResponse', `Error: ${error.message}`);
                }
            }
        }

        async function runFullSummaryPipelineTest() {
            const job = 'summary-test-' + Date.now();
            showResponse('summaryPipelineResponse', 'üîÑ Running full summary pipeline test...');
            
            const steps = [];
            try {
                steps.push('1. Checking API health...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                const healthResponse = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                if (!healthResponse.ok) throw new Error('API health check failed');

                steps.push('2. Uploading summary files...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                steps.push('3. Triggering summary analysis job...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                steps.push('4. Waiting for processing...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 2000));

                steps.push('5. Retrieving summary results...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                const analysisResponse = await fetch(`${getSummaryApiUrl()}/summary-analysis/${job}`);
                const analysisData = await analysisResponse.json();

                steps.push('‚úÖ Summary pipeline test completed successfully');
                showResponse('summaryPipelineResponse', steps.join('\n') + '\n\nResults:\n' + formatJson(analysisData));
            } catch (error) {
                steps.push(`‚ùå Error: ${error.message}`);
                showResponse('summaryPipelineResponse', steps.join('\n'));
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            testConnection();
            updateDBStatusBadge();
        });

        async function updateDBStatusBadge() {
            const badge = document.getElementById('dbStatusBadge');
            try {
                const res = await fetch(`${getApiUrl()}/db/status`);
                const data = await res.json();
                if (data.connected) {
                    badge.textContent = 'DB: Connected';
                    badge.classList.remove('bg-zinc-100','text-zinc-600','border-zinc-200');
                    badge.classList.add('bg-green-50','text-green-700','border','border-green-200');
                } else {
                    badge.textContent = 'DB: Not Connected';
                    badge.classList.remove('bg-zinc-100','text-zinc-600','border-zinc-200');
                    badge.classList.add('bg-red-50','text-red-700','border','border-red-200');
                }
            } catch {
                badge.textContent = 'DB: Not Connected';
                badge.classList.remove('bg-zinc-100','text-zinc-600','border-zinc-200');
                badge.classList.add('bg-red-50','text-red-700','border','border-red-200');
            }
        }

        function renderCorrectionAggregate(data) {
            const wrap = document.getElementById('corrAggregateView');
            const ev = document.getElementById('aggEvent');
            const ex = document.getElementById('aggExplanations');
            const wd = document.getElementById('aggWords');
            const sn = document.getElementById('aggSentences');
            wrap.classList.remove('hidden');
            ev.textContent = `jobId: ${data.event.jobId} | modelId: ${data.event.modelId} | promptId: ${data.event.promptId} | occurred_at: ${data.event.occurred_at}`;
            ex.innerHTML = Array.isArray(data.explanations) ? data.explanations.map(e => `<div>‚Ä¢ ${e.explanation} (v${e.version}) @ ${e.created_at}</div>`).join('') : 'No explanations';
            wd.innerHTML = Array.isArray(data.words) ? data.words.map(w => `<div>‚Ä¢ ${w.before} ‚Üí ${w.after} ${w.position!=null?`(pos ${w.position})`:''} ${w.confidence!=null?`(conf ${w.confidence})`:''} @ ${w.created_at}</div>`).join('') : 'No word corrections';
            sn.innerHTML = Array.isArray(data.sentences) ? data.sentences.map(s => `<div>‚Ä¢ ${s.originalLocation} ‚Üí ${s.newLocation} [${s.transformation}] @ ${s.created_at}</div>`).join('') : 'No sentence movements';
        }
    </script>
</body>
</html>
