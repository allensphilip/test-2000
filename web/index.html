<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcript Analysis API - Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Tab Menu Styles */
        .tab-menu {
            display: flex;
            background: #2c3e50;
            padding: 0 30px;
            border-bottom: 4px solid #34495e;
        }

        .tab-button {
            padding: 15px 30px;
            font-size: 1.2em;
            color: white;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-weight: 600;
        }

        .tab-button:hover {
            background: rgba(255,255,255,0.1);
        }

        .tab-button.active {
            color: #3498db;
            background: white;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 4px;
            background: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }

        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .section-header h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .section-header p {
            color: #6c757d;
            font-size: 1.1em;
        }

        .section-content {
            padding: 25px;
        }

        .test-group {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .test-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .response-area {
            margin-top: 20px;
            padding: 20px;
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #34495e;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }

        .config-section {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .file-upload {
            border: 2px dashed #dee2e6;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-label {
            cursor: pointer;
            color: #007bff;
            font-weight: 600;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-weight: 600;
        }

        .alert {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border: 1px solid transparent;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ MedSum Analysis API</h1>
            <p>Complete Testing Interface for Transcription & Summary Analysis</p>
        </div>

        <div class="tab-menu">
            <button class="tab-button active" onclick="switchTab('transcription')">üìù Transcription Analysis</button>
            <button class="tab-button" onclick="switchTab('summary')">üìã Summary Analysis</button>
        </div>

        <div class="content">
            <!-- Transcription Analysis Tab -->
            <div id="transcription-tab" class="tab-content active">
            <!-- Configuration Section -->
            <div class="section config-section">
                <div class="section-header">
                    <h2>‚öôÔ∏è Configuration</h2>
                    <p>Set your API endpoint and storage type</p>
                </div>
                <div class="section-content">
                    <div class="form-group">
                        <label for="apiUrl">API Base URL:</label>
                        <input type="text" id="apiUrl" value="http://localhost:8080" placeholder="http://localhost:8080">
                    </div>
                    <div class="form-group">
                        <label for="storageType">Storage Type:</label>
                        <select id="storageType">
                            <option value="minio">MinIO (Local)</option>
                            <option value="s3">AWS S3 (Production)</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="testConnection()">üîó Test Connection</button>
                    <div id="connectionStatus"></div>
                </div>
            </div>

            <!-- Health Check Section -->
            <div class="section">
                <div class="section-header">
                    <h2>üíö Health Check</h2>
                    <p>Verify API is running and accessible</p>
                </div>
                <div class="section-content">
                    <div class="test-group">
                        <h3>API Health Status</h3>
                        <button class="btn" onclick="checkHealth()">üè• Check Health</button>
                        <button class="btn btn-warning" onclick="checkAllServices()">üîç Check All Services</button>
                        <div id="healthResponse" class="response-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- File Upload Section -->
            <div class="section">
                <div class="section-header">
                    <h2>üìÅ File Upload & Management</h2>
                    <p>Upload transcript files and manage storage</p>
                </div>
                <div class="section-content">
                    <div class="test-group">
                        <h3>Upload Transcript Files</h3>
                        <div class="form-group">
                            <label for="job">Job:</label>
                            <input type="text" id="job" value="test-job-456" placeholder="Enter job">
                        </div>
                        
                        <div class="file-upload">
                            <input type="file" id="transcriptionFile" accept=".txt">
                            <label for="transcriptionFile" class="file-upload-label">
                                üìÑ Click to select Transcription (.txt)
                            </label>
                            <div id="transcriptionFileName"></div>
                        </div>
                        
                        <div class="file-upload" style="margin-top: 15px;">
                            <input type="file" id="correctedFile" accept=".txt">
                            <label for="correctedFile" class="file-upload-label">
                                ‚úÖ Click to select Corrected Transcript (.txt)
                            </label>
                            <div id="correctedFileName"></div>
                        </div>
                        
                        <button class="btn btn-success" onclick="uploadFiles()">‚¨ÜÔ∏è Upload Files</button>
                        <button class="btn btn-warning" onclick="listFiles()">üìã List Files</button>
                        <div id="uploadResponse" class="response-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Job Processing Section -->
            <div class="section">
                <div class="section-header">
                    <h2>‚ö° Job Processing</h2>
                    <p>Trigger analysis jobs and monitor progress</p>
                </div>
                <div class="section-content">
                    <div class="test-group">
                        <h3>Trigger Analysis Job</h3>
                        <div class="form-group">
                            <label for="triggerJob">Job to Process:</label>
                            <input type="text" id="triggerJob" value="test-job-456" placeholder="Enter job">
                        </div>
                        <button class="btn" onclick="triggerJob()">üöÄ Trigger Analysis</button>
                        <button class="btn btn-warning" onclick="checkJobStatus()">üìä Check Status</button>
                        <div id="jobResponse" class="response-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- Analysis Results Section -->
            <div class="section">
                <div class="section-header">
                    <h2>üìä Analysis Results</h2>
                    <p>Retrieve and display analysis metrics</p>
                </div>
                <div class="section-content">
                    <div class="test-group">
                        <h3>Get Analysis Results</h3>
                        <div class="form-group">
                            <label for="analysisJob">Job:</label>
                            <input type="text" id="analysisJob" value="test-job-123" placeholder="Enter job">
                        </div>
                        <button class="btn" onclick="getAnalysis()">üìà Get Results</button>
                        <button class="btn btn-success" onclick="getAnalysisFormatted()">üé® Get Formatted Results</button>
                        <div id="analysisResponse" class="response-area" style="display: none;"></div>
                        <div id="metricsDisplay" style="display: none;">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-value" id="werValue">-</div>
                                    <div class="metric-label">WER (Word Error Rate)</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value" id="cerValue">-</div>
                                    <div class="metric-label">CER (Character Error Rate)</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value" id="bleuValue">-</div>
                                    <div class="metric-label">BLEU Score</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value" id="cometValue">-</div>
                                    <div class="metric-label">COMET Score</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Database Testing Section -->
            <div class="section">
                <div class="section-header">
                    <h2>üóÑÔ∏è Database Testing</h2>
                    <p>Test database connectivity and data storage</p>
                </div>
                <div class="section-content">
                    <div class="test-group">
                        <h3>Database Operations</h3>
                        <button class="btn" onclick="testDatabase()">üîç Test DB Connection</button>
                        <button class="btn btn-warning" onclick="listAllResults()">üìã List All Results</button>
                        <button class="btn btn-danger" onclick="clearTestData()">üóëÔ∏è Clear Test Data</button>
                        <div id="databaseResponse" class="response-area" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- End-to-End Testing -->
            <div class="section">
                <div class="section-header">
                    <h2>üîÑ End-to-End Testing</h2>
                    <p>Complete pipeline testing from upload to results</p>
                </div>
                <div class="section-content">
                    <div class="test-group">
                        <h3>Full Pipeline Test</h3>
                        <div class="alert alert-info">
                            <strong>Info:</strong> This will run a complete test including file upload, job processing, and result retrieval.
                        </div>
                        <button class="btn btn-success" onclick="runFullPipelineTest()">üöÄ Run Full Pipeline Test</button>
                        <div id="pipelineResponse" class="response-area" style="display: none;"></div>
                    </div>
                </div>
                </div>
            </div>

            <!-- Summary Analysis Tab -->
            <div id="summary-tab" class="tab-content">
                <!-- Configuration Section -->
                <div class="section config-section">
                    <div class="section-header">
                        <h2>‚öôÔ∏è Configuration</h2>
                        <p>Set your API endpoint and storage type</p>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <label for="summaryApiUrl">API Base URL:</label>
                            <input type="text" id="summaryApiUrl" value="http://localhost:8080" placeholder="http://localhost:8080">
                        </div>
                        <div class="form-group">
                            <label for="summaryStorageType">Storage Type:</label>
                            <select id="summaryStorageType">
                                <option value="minio">MinIO (Local)</option>
                                <option value="s3">AWS S3 (Production)</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="testSummaryConnection()">üîó Test Connection</button>
                        <div id="summaryConnectionStatus"></div>
                    </div>
                </div>

                <!-- Health Check Section -->
                <div class="section">
                    <div class="section-header">
                        <h2>üíö Health Check</h2>
                        <p>Verify Summary API is running and accessible</p>
                    </div>
                    <div class="section-content">
                        <div class="test-group">
                            <h3>Summary API Health Status</h3>
                            <button class="btn" onclick="checkSummaryHealth()">üè• Check Health</button>
                            <button class="btn btn-warning" onclick="checkSummaryServices()">üîç Check All Services</button>
                            <div id="summaryHealthResponse" class="response-area" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- File Upload Section -->
                <div class="section">
                    <div class="section-header">
                        <h2>üìÅ Summary File Upload</h2>
                        <p>Upload original and summary files</p>
                    </div>
                    <div class="section-content">
                        <div class="test-group">
                            <h3>Upload Summary Files</h3>
                            <div class="form-group">
                                <label for="summaryJob">Job:</label>
                                <input type="text" id="summaryJob" value="summary-job-456" placeholder="Enter job">
                            </div>
                            
                            <div class="file-upload">
                                <input type="file" id="originalSummaryFile" accept=".txt">
                                <label for="originalSummaryFile" class="file-upload-label">
                                    üìÑ Click to select Original Text (.txt)
                                </label>
                                <div id="originalSummaryFileName"></div>
                            </div>
                            
                            <div class="file-upload" style="margin-top: 15px;">
                                <input type="file" id="generatedSummaryFile" accept=".txt">
                                <label for="generatedSummaryFile" class="file-upload-label">
                                    ‚úÖ Click to select Generated Summary (.txt)
                                </label>
                                <div id="generatedSummaryFileName"></div>
                            </div>
                            
                            <button class="btn btn-success" onclick="uploadSummaryFiles()">‚¨ÜÔ∏è Upload Files</button>
                            <button class="btn btn-warning" onclick="listSummaryFiles()">üìã List Files</button>
                            <div id="summaryUploadResponse" class="response-area" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Summary Job Processing Section -->
                <div class="section">
                    <div class="section-header">
                        <h2>‚ö° Summary Job Processing</h2>
                        <p>Trigger summary analysis jobs and monitor progress</p>
                    </div>
                    <div class="section-content">
                        <div class="test-group">
                            <h3>Trigger Summary Analysis</h3>
                            <div class="form-group">
                                <label for="triggerSummaryJob">Job to Process:</label>
                                <input type="text" id="triggerSummaryJob" value="summary-job-456" placeholder="Enter job">
                            </div>
                            <button class="btn" onclick="triggerSummaryJob()">üöÄ Trigger Analysis</button>
                            <button class="btn btn-warning" onclick="checkSummaryJobStatus()">üìä Check Status</button>
                            <div id="summaryJobResponse" class="response-area" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Summary Analysis Results Section -->
                <div class="section">
                    <div class="section-header">
                        <h2>üìä Summary Analysis Results</h2>
                        <p>Retrieve and display summary analysis metrics</p>
                    </div>
                    <div class="section-content">
                        <div class="test-group">
                            <h3>Get Summary Analysis Results</h3>
                            <div class="form-group">
                                <label for="summaryAnalysisJob">Job:</label>
                                <input type="text" id="summaryAnalysisJob" value="summary-job-123" placeholder="Enter job">
                            </div>
                            <button class="btn" onclick="getSummaryAnalysis()">üìà Get Results</button>
                            <button class="btn btn-success" onclick="getSummaryAnalysisFormatted()">üé® Get Formatted Results</button>
                            <div id="summaryAnalysisResponse" class="response-area" style="display: none;"></div>
                            <div id="summaryMetricsDisplay" style="display: none;">
                                <div class="metrics-grid">
                                    <div class="metric-card">
                                        <div class="metric-value" id="summaryWerValue">-</div>
                                        <div class="metric-label">WER (Word Error Rate)</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-value" id="summaryCerValue">-</div>
                                        <div class="metric-label">CER (Character Error Rate)</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-value" id="summaryBleuValue">-</div>
                                        <div class="metric-label">BLEU Score</div>
                                    </div>
                                    <div class="metric-card">
                                        <div class="metric-value" id="summaryRougeValue">-</div>
                                        <div class="metric-label">ROUGE Score</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Summary Database Testing Section -->
                <div class="section">
                    <div class="section-header">
                        <h2>üóÑÔ∏è Summary Database Testing</h2>
                        <p>Test summary database operations</p>
                    </div>
                    <div class="section-content">
                        <div class="test-group">
                            <h3>Summary Database Operations</h3>
                            <button class="btn" onclick="testSummaryDatabase()">üîç Test DB Connection</button>
                            <button class="btn btn-warning" onclick="listAllSummaryResults()">üìã List All Results</button>
                            <button class="btn btn-danger" onclick="clearSummaryTestData()">üóëÔ∏è Clear Test Data</button>
                            <div id="summaryDatabaseResponse" class="response-area" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Summary End-to-End Testing -->
                <div class="section">
                    <div class="section-header">
                        <h2>üîÑ Summary End-to-End Testing</h2>
                        <p>Complete summary pipeline testing</p>
                    </div>
                    <div class="section-content">
                        <div class="test-group">
                            <h3>Full Summary Pipeline Test</h3>
                            <div class="alert alert-info">
                                <strong>Info:</strong> This will run a complete summary test including file upload, analysis, and result retrieval.
                            </div>
                            <button class="btn btn-success" onclick="runFullSummaryPipelineTest()">üöÄ Run Full Pipeline Test</button>
                            <div id="summaryPipelineResponse" class="response-area" style="display: none;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching Function
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // File selection handlers for Transcription
        document.getElementById('transcriptionFile').addEventListener('change', function(e) {
            document.getElementById('transcriptionFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        document.getElementById('correctedFile').addEventListener('change', function(e) {
            document.getElementById('correctedFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        // File selection handlers for Summary
        document.getElementById('originalSummaryFile').addEventListener('change', function(e) {
            document.getElementById('originalSummaryFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        document.getElementById('generatedSummaryFile').addEventListener('change', function(e) {
            document.getElementById('generatedSummaryFileName').textContent = e.target.files[0]?.name || 'No file selected';
        });

        // Utility functions
        function getApiUrl(type = 'transcription') {
            return document.getElementById(type === 'summary' ? 'summaryApiUrl' : 'apiUrl').value.replace(/\/$/, '');
        }

        function getSummaryApiUrl() {
            return getApiUrl('summary');
        }

        function showResponse(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = content;
            element.style.color = isError ? '#e74c3c' : '#2ecc71';
        }

        function formatJson(obj) {
            return JSON.stringify(obj, null, 2);
        }

        function updateSummaryMetrics(data) {
            document.getElementById('summaryWerValue').textContent = data.wer.toFixed(2);
            document.getElementById('summaryCerValue').textContent = data.cer.toFixed(2);
            document.getElementById('summaryBleuValue').textContent = data.bleu.toFixed(3);
            document.getElementById('summaryRougeValue').textContent = data.rouge.toFixed(3);
            document.getElementById('summaryMetricsDisplay').style.display = 'block';
        }

        // Summary-specific utility functions
        function getSummaryApiUrl() {
            return getApiUrl('summary');
        }

        function updateSummaryMetrics(data) {
            document.getElementById('summaryWerValue').textContent = data.wer.toFixed(2);
            document.getElementById('summaryCerValue').textContent = data.cer.toFixed(2);
            document.getElementById('summaryBleuValue').textContent = data.bleu.toFixed(2);
            document.getElementById('summaryRougeValue').textContent = data.rouge.toFixed(2);
            document.getElementById('summaryMetricsDisplay').style.display = 'block';
        }

        // API Testing Functions
        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = '<div class="alert alert-info">üîÑ Testing connection...</div>';
            
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="alert alert-success">‚úÖ Connection successful!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="alert alert-danger">‚ùå Connection failed!</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">‚ùå Connection error: ${error.message}</div>`;
            }
        }

        async function checkHealth() {
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                const data = await response.json();
                showResponse('healthResponse', `Status: ${response.status}\nResponse: ${formatJson(data)}`);
            } catch (error) {
                showResponse('healthResponse', `Error: ${error.message}`, true);
            }
        }

        async function checkAllServices() {
            const services = ['API', 'Database', 'Cache', 'Storage'];
            let results = 'Service Status Check:\n\n';
            
            for (const service of services) {
                results += `${service}: `;
                try {
                    const response = await fetch(`${getApiUrl()}/healthcheck`);
                    results += response.ok ? '‚úÖ Online\n' : '‚ùå Offline\n';
                } catch (error) {
                    results += '‚ùå Error\n';
                }
            }
            
            showResponse('healthResponse', results);
        }

        async function uploadFiles() {
            const job = document.getElementById('job').value;
            const originalFile = document.getElementById('transcriptionFile').files[0];
            const correctedFile = document.getElementById('correctedFile').files[0];
            
            if (!job || !originalFile || !correctedFile) {
                showResponse('uploadResponse', 'Please provide job and both files', true);
                return;
            }
            
            showResponse('uploadResponse', 'üîÑ Uploading files...');
            
            try {
                const formData = new FormData();
                formData.append('job', job);
                // Backend will now expect keys: transcription and corrected
                formData.append('transcription', originalFile);
                formData.append('corrected', correctedFile);
                // Keep older/alternate keys for backward compatibility
                formData.append('originalFile', originalFile);
                formData.append('transcribedFile', correctedFile);

                const response = await fetch(`${getApiUrl()}/transcript-analysis/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('uploadResponse', `Files uploaded successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('uploadResponse', `Error: ${data.error || 'Failed to upload files'}`, true);
                }
            } catch (error) {
                showResponse('uploadResponse', `Error: ${error.message}`, true);
            }
        }

        async function listFiles() {
            showResponse('uploadResponse', 'üìã Listing files...');
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/list`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('uploadResponse', `Files in storage:\n${formatJson(data)}`);
                } else {
                    showResponse('uploadResponse', `Error: ${data.error || 'Failed to list files'}`, true);
                }
            } catch (error) {
                showResponse('uploadResponse', `Error: ${error.message}`, true);
            }
        }

        async function triggerJob() {
            const job = document.getElementById('triggerJob').value;
            if (!job) {
                showResponse('jobResponse', 'Please provide job', true);
                return;
            }
            
            showResponse('jobResponse', `üöÄ Triggering analysis for job: ${job}`);
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/trigger/${job}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('jobResponse', `Job triggered successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('jobResponse', `Error: ${data.error || 'Failed to trigger job'}`, true);
                }
            } catch (error) {
                showResponse('jobResponse', `Error: ${error.message}`, true);
            }
        }

        async function checkJobStatus() {
            const job = document.getElementById('triggerJob').value;
            if (!job) {
                showResponse('jobResponse', 'Please provide job', true);
                return;
            }
            
            showResponse('jobResponse', `üìä Checking status for job: ${job}`);
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/status/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('jobResponse', `Job status:\n${formatJson(data)}`);
                } else {
                    showResponse('jobResponse', `Error: ${data.error || 'Failed to check job status'}`, true);
                }
            } catch (error) {
                showResponse('jobResponse', `Error: ${error.message}`, true);
            }
        }

        async function getAnalysis() {
            const job = document.getElementById('analysisJob').value;
            if (!job) {
                showResponse('analysisResponse', 'Please provide job', true);
                return;
            }
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('analysisResponse', `Analysis results:\n${formatJson(data)}`);
                    // Update metrics display with the direct values from the API
                    document.getElementById('werValue').textContent = data.wer.toFixed(2);
                    document.getElementById('cerValue').textContent = data.cer.toFixed(2);
                    document.getElementById('bleuValue').textContent = data.bleu.toFixed(3);
                    document.getElementById('cometValue').textContent = data.comet ? data.comet.toFixed(3) : 'N/A';
                    document.getElementById('metricsDisplay').style.display = 'block';
                } else {
                    showResponse('analysisResponse', `Error: ${data.error || 'Failed to get analysis results'}`, true);
                    document.getElementById('metricsDisplay').style.display = 'none';
                }
            } catch (error) {
                showResponse('analysisResponse', `Error: ${error.message}`, true);
                document.getElementById('metricsDisplay').style.display = 'none';
            }
        }

        async function getAnalysisFormatted() {
            await getAnalysis();
        }

        async function testDatabase() {
            showResponse('databaseResponse', 'üîÑ Testing database connection...');
            
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('databaseResponse', `Database connection test successful:\n${formatJson(data)}`);
                } else {
                    showResponse('databaseResponse', `Database connection test failed:\n${formatJson(data)}`, true);
                }
            } catch (error) {
                showResponse('databaseResponse', `Database connection error: ${error.message}`, true);
            }
        }

        async function listAllResults() {
            showResponse('databaseResponse', 'üîÑ Fetching all analysis results...');
            
            try {
                const response = await fetch(`${getApiUrl()}/transcript-analysis/list`);
                const data = await response.json();
                if (Array.isArray(data)) {
                    const formattedData = data.map(result => ({
                        ...result,
                        created_at: new Date(result.created_at).toLocaleString(),
                        updated_at: new Date(result.updated_at).toLocaleString()
                    }));
                    showResponse('databaseResponse', `All analysis results:\n${formatJson(formattedData)}`);
                } else {
                    showResponse('databaseResponse', `All analysis results:\n${formatJson(data)}`);
                }
            } catch (error) {
                showResponse('databaseResponse', `Error fetching results: ${error.message}`, true);
            }
        }

        async function clearTestData() {
            if (confirm('Are you sure you want to clear test data?')) {
                showResponse('databaseResponse', 'üóëÔ∏è Clearing test data...');
                
                try {
                    const response = await fetch(`${getApiUrl()}/transcript-analysis/clear`, { method: 'POST' });
                    const data = await response.json();
                    
                    if (response.ok) {
                        showResponse('databaseResponse', '‚úÖ Test data cleared successfully');
                    } else {
                        showResponse('databaseResponse', `Error: ${data.error || 'Failed to clear test data'}`, true);
                    }
                } catch (error) {
                    showResponse('databaseResponse', `Error: ${error.message}`, true);
                }
            }
        }

        async function runFullPipelineTest() {
            const job = 'test-' + Date.now();
            showResponse('pipelineResponse', 'üîÑ Running full pipeline test...');
            
            const steps = [];
            try {
                // Step 1: Check API health
                steps.push('1. Checking API health...');
                showResponse('pipelineResponse', steps.join('\n'));
                const healthResponse = await fetch(`${getApiUrl()}/healthcheck`);
                if (!healthResponse.ok) throw new Error('API health check failed');

                // Step 2: Upload test files
                steps.push('2. Uploading files...');
                showResponse('pipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Step 3: Trigger analysis
                steps.push('3. Triggering analysis job...');
                showResponse('pipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Step 4: Wait for processing
                steps.push('4. Waiting for processing...');
                showResponse('pipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Step 5: Get results
                steps.push('5. Retrieving results...');
                showResponse('pipelineResponse', steps.join('\n'));
                const analysisResponse = await fetch(`${getApiUrl()}/transcript-analysis/${job}`);
                const analysisData = await analysisResponse.json();

                steps.push('‚úÖ Pipeline test completed successfully');
                showResponse('pipelineResponse', steps.join('\n') + '\n\nResults:\n' + formatJson(analysisData));
            } catch (error) {
                steps.push(`‚ùå Error: ${error.message}`);
                showResponse('pipelineResponse', steps.join('\n'), true);
            }
        }

        // Summary API Testing Functions
        async function testSummaryConnection() {
            const statusDiv = document.getElementById('summaryConnectionStatus');
            statusDiv.innerHTML = '<div class="alert alert-info">üîÑ Testing connection...</div>';
            
            try {
                const response = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                if (response.ok) {
                    statusDiv.innerHTML = '<div class="alert alert-success">‚úÖ Connection successful!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="alert alert-danger">‚ùå Connection failed!</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="alert alert-danger">‚ùå Connection error: ${error.message}</div>`;
            }
        }

        async function checkSummaryHealth() {
            try {
                const response = await fetch(`${getSummaryApiUrl()}/healthcheck`);
                const data = await response.json();
                showResponse('summaryHealthResponse', `Status: ${response.status}\nResponse: ${formatJson(data)}`);
            } catch (error) {
                showResponse('summaryHealthResponse', `Error: ${error.message}`, true);
            }
        }

        async function uploadSummaryFiles() {
            const job = document.getElementById('summaryJob').value;
            const originalFile = document.getElementById('originalSummaryFile').files[0];
            const summaryFile = document.getElementById('generatedSummaryFile').files[0];
            
            if (!job || !originalFile || !summaryFile) {
                showResponse('summaryUploadResponse', 'Please provide job and both files', true);
                return;
            }
            
            showResponse('summaryUploadResponse', 'üîÑ Uploading files...');
            
            try {
                const formData = new FormData();
                formData.append('job', job);
                formData.append('originalFile', originalFile);
                formData.append('correctedFile', summaryFile);

                const response = await fetch(`${getSummaryApiUrl()}/summary-analysis/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryUploadResponse', `Files uploaded successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryUploadResponse', `Error: ${data.error || 'Failed to upload files'}`, true);
                }
            } catch (error) {
                showResponse('summaryUploadResponse', `Error: ${error.message}`, true);
            }
        }

        async function triggerSummaryJob() {
            const job = document.getElementById('triggerSummaryJob').value;
            if (!job) {
                showResponse('summaryJobResponse', 'Please provide job', true);
                return;
            }
            
            showResponse('summaryJobResponse', 'üîÑ Triggering summary analysis...');
            
            try {
                const response = await fetch(`${getApiUrl()}/summary-analysis/trigger/${job}`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryJobResponse', `Job triggered successfully:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryJobResponse', `Error: ${data.error || 'Failed to trigger job'}`, true);
                }
            } catch (error) {
                showResponse('summaryJobResponse', `Error: ${error.message}`, true);
            }
        }

        async function getSummaryAnalysis() {
            const job = document.getElementById('summaryAnalysisJob').value;
            if (!job) {
                showResponse('summaryAnalysisResponse', 'Please provide a job', true);
                return;
            }

            showResponse('summaryAnalysisResponse', 'üîÑ Fetching summary analysis results...');
            
            try {
                const response = await fetch(`${getApiUrl()}/summary-analysis/${job}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryAnalysisResponse', `Summary analysis results:\n${formatJson(data)}`);
                    if (data.metrics) {
                        updateSummaryMetrics(data.metrics);
                    }
                } else {
                    showResponse('summaryAnalysisResponse', `Error: ${data.error || 'Failed to get summary analysis results'}`, true);
                }
            } catch (error) {
                showResponse('summaryAnalysisResponse', `Error: ${error.message}`, true);
            }
        }

        async function getSummaryAnalysisFormatted() {
            await getSummaryAnalysis();
        }

        async function testSummaryDatabase() {
            showResponse('summaryDatabaseResponse', 'üîÑ Testing database connection...');
            
            try {
                const response = await fetch(`${getApiUrl()}/healthcheck`);
                const data = await response.json();
                
                if (response.ok) {
                    showResponse('summaryDatabaseResponse', `Database connection test successful:\n${formatJson(data)}`);
                } else {
                    showResponse('summaryDatabaseResponse', `Database connection test failed:\n${formatJson(data)}`, true);
                }
            } catch (error) {
                showResponse('summaryDatabaseResponse', `Database connection error: ${error.message}`, true);
            }
        }

        async function listAllSummaryResults() {
            showResponse('summaryDatabaseResponse', 'üîÑ Fetching all summary results...');
            
            try {
                const response = await fetch(`${getApiUrl()}/summary-analysis/list`);
                const data = await response.json();
                if (Array.isArray(data)) {
                    const formattedData = data.map(result => ({
                        ...result,
                        created_at: new Date(result.created_at).toLocaleString(),
                        updated_at: new Date(result.updated_at).toLocaleString()
                    }));
                    showResponse('summaryDatabaseResponse', `All summary results:\n${formatJson(formattedData)}`);
                } else {
                    showResponse('summaryDatabaseResponse', `All summary results:\n${formatJson(data)}`);
                }
            } catch (error) {
                showResponse('summaryDatabaseResponse', `Error fetching summary results: ${error.message}`, true);
            }
        }

        async function runFullSummaryPipelineTest() {
            const job = 'summary-test-' + Date.now();
            showResponse('summaryPipelineResponse', 'üîÑ Running full summary pipeline test...');
            
            const steps = [];
            try {
                // Step 1: Check API health
                steps.push('1. Checking API health...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                const healthResponse = await fetch(`${getApiUrl()}/healthcheck`);
                if (!healthResponse.ok) throw new Error('API health check failed');

                // Step 2: Upload test files
                steps.push('2. Uploading summary files...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Step 3: Trigger summary analysis
                steps.push('3. Triggering summary analysis job...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Step 4: Wait for processing
                steps.push('4. Waiting for processing...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Step 5: Get results
                steps.push('5. Retrieving summary results...');
                showResponse('summaryPipelineResponse', steps.join('\n'));
                const analysisResponse = await fetch(`${getApiUrl()}/summary-analysis/${job}`);
                const analysisData = await analysisResponse.json();

                steps.push('‚úÖ Summary pipeline test completed successfully');
                showResponse('summaryPipelineResponse', steps.join('\n') + '\n\nResults:\n' + formatJson(analysisData));
            } catch (error) {
                steps.push(`‚ùå Error: ${error.message}`);
                showResponse('summaryPipelineResponse', steps.join('\n'), true);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            testConnection();
        });
    </script>
</body>
</html>