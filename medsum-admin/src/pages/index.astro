---
import DashboardSidebar from "@/components/layout/DashboardSidebar"

import '../styles/global.css';
import { listClients, type Client } from "@/server/clients";
import ClientCards from "@/components/clients/ClientCards";
import { toast } from 'sonner';

const {user} = Astro.locals as any
if (!user) return Astro.redirect("/login")

let clients: Client[] = []

try {
  clients = await listClients()
} catch (e: any) {
  toast.error(e?.message ?? "Couldn't fetch clients")
}

import MainLayout from "@/layouts/main.astro"
---

<MainLayout content={{title: "Medsum - Overview"}} user={user} active="overview">
  <h1 class="text-2xl font-semibold mb-4">Clients</h1>
  <ClientCards clients={clients} client:load />
</MainLayout>
